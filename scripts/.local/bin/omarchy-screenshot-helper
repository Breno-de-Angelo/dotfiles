#!/bin/bash

# omarchy-screenshot-helper
# Wrapper around grim/slurp for Omarchy-like screenshot flow in Sway

MODE="$1"
DIR="$HOME/Pictures/Screenshots"
mkdir -p "$DIR"
FILENAME="$DIR/screenshot-$(date +'%Y-%m-%d_%H-%M-%S').png"

notify_save() {
    notify-send "Screenshot Saved" "Saved to $FILENAME" -i "$FILENAME"
}

case "$MODE" in
    "full")
        grim "$FILENAME"
        notify_save
        ;;
    "region")
        slurp | grim -g - "$FILENAME"
        notify_save
        ;;
    "window")
        # Captures the currently focused window in Sway
        GEOM=$(swaymsg -t get_tree | jq -r '.. | select(.focused? == true).rect | "\(.x),\(.y) \(.width)x\(.height)"')
        grim -g "$GEOM" "$FILENAME"
        notify_save
        ;;
    *)
        echo "Usage: $0 {full|region|window}"
        exit 1
        ;;
esac